#!/bin/bash
set -e

case "$1" in
    configure)
        echo "Setting up TalkType..."

        # Create virtual environment and install dependencies
        if [ ! -d /opt/talktype/venv ]; then
            echo "Creating virtual environment..."
            python3 -m venv /opt/talktype/venv
        fi

        echo "Installing Python dependencies..."
        /opt/talktype/venv/bin/pip install --upgrade pip > /dev/null 2>&1
        /opt/talktype/venv/bin/pip install -r /opt/talktype/requirements.txt > /dev/null 2>&1

        echo ""
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘            TalkType 0.1.0 Installed Successfully!          â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "ðŸ“¦ Installation complete!"
        echo ""
        echo "Next steps:"
        echo ""
        echo "1. Add yourself to 'input' group (if not already):"
        echo "   sudo usermod -a -G input \$USER"
        echo "   Then LOG OUT and LOG BACK IN"
        echo ""
        echo "2. Set up GNOME keyboard shortcut:"
        echo "   Settings â†’ Keyboard â†’ Custom Shortcuts"
        echo "   Command: /opt/talktype/venv/bin/python /opt/talktype/talktype_toggle.py"
        echo "   Shortcut: Ctrl+Space"
        echo ""
        echo "3. Install systemd service:"
        echo "   mkdir -p ~/.config/systemd/user"
        echo "   cp /opt/talktype/talktype.service ~/.config/systemd/user/"
        echo "   systemctl --user daemon-reload"
        echo "   systemctl --user enable talktype"
        echo "   systemctl --user start talktype"
        echo ""
        echo "4. Load aliases (optional):"
        echo "   echo 'source /opt/talktype/talktype-aliases.sh' >> ~/.bashrc"
        echo ""
        echo "5. Run setup wizard (recommended):"
        echo "   talktype install"
        echo ""
        echo "Commands:"
        echo "  talktype help    - Show help"
        echo "  talktype check   - Check if working"
        echo "  talktype logs    - View logs"
        echo ""
        echo "Documentation: /opt/talktype/WAYLAND_SETUP.md"
        echo ""
        ;;

    abort-upgrade|abort-remove|abort-deconfigure)
        ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0
